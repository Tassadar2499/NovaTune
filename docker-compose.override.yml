# =============================================================================
# Development-specific overrides for local development
# This file is automatically merged with docker-compose.yml
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # RavenDB Development Settings
  # ---------------------------------------------------------------------------
  ravendb:
    environment:
      # License file path (mount your license for production features)
      - RAVEN_License_Path=/opt/RavenDB/Server/license.json
      # Enable detailed logging for debugging
      - RAVEN_Logs_Mode=Information
    # Uncomment to mount a license file for development:
    # volumes:
    #   - ./config/ravendb-license.json:/opt/RavenDB/Server/license.json:ro

  # ---------------------------------------------------------------------------
  # MinIO Development Settings
  # ---------------------------------------------------------------------------
  minio:
    environment:
      # Allow environment variable override for credentials
      - MINIO_ROOT_USER=${MINIO_ACCESS_KEY:-minioadmin}
      - MINIO_ROOT_PASSWORD=${MINIO_SECRET_KEY:-minioadmin}
      # Enable browser console access
      - MINIO_BROWSER=on
    # Create default bucket on startup
    entrypoint: >
      /bin/sh -c "
      mkdir -p /data/novatune-dev-audio;
      minio server /data --console-address ':9001';
      "

  # ---------------------------------------------------------------------------
  # Redpanda Development Settings
  # ---------------------------------------------------------------------------
  redpanda:
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # ---------------------------------------------------------------------------
  # Garnet Development Settings
  # ---------------------------------------------------------------------------
  garnet:
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # ---------------------------------------------------------------------------
  # Optional: Add development-only services
  # ---------------------------------------------------------------------------

  # Redpanda Console for topic inspection
  redpanda-console:
    image: redpandadata/console:v2.7.2
    container_name: novatune-redpanda-console
    ports:
      - "8181:8080"
    environment:
      - KAFKA_BROKERS=redpanda:9092
    depends_on:
      - redpanda
    profiles:
      - debug
    networks:
      - novatune-network

  # Mailhog for email testing (useful for auth flows)
  mailhog:
    image: mailhog/mailhog:latest
    container_name: novatune-mailhog
    ports:
      - "1025:1025"   # SMTP
      - "8025:8025"   # Web UI
    profiles:
      - debug
    networks:
      - novatune-network
